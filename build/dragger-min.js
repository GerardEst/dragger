var s=[];function n(t){s=t.length>0?[...t]:[t],b();for(let e of s)e.ondragstart=()=>!1,$(e),A(e),B(e)}function b(){document.addEventListener("mousemove",t=>{let e=document.querySelector("[dragging]");e&&h(e,{x:t.clientX,y:t.clientY,shift:t.shiftKey,ctrl:t.ctrlKey})})}function R(t){s.push(t),prepareElement(t)}function $(t){t.style.userSelect="none",t.style.position="absolute",t.style.margin=0}function A(t){t.addEventListener("touchstart",e=>{f(e.target,{x:e.touches[0].clientX,y:e.touches[0].clientY})}),t.addEventListener("touchmove",e=>{h(e.target,{x:e.touches[0].clientX,y:e.touches[0].clientY})}),t.addEventListener("touchend",e=>{a(e.target,{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY})})}function B(t){t.addEventListener("mousedown",e=>{f(t,{x:e.clientX,y:e.clientY,shift:e.shiftKey,ctrl:e.ctrlKey})}),t.addEventListener("mouseup",e=>{a(t,{x:e.clientX,y:e.clientY,shift:e.shiftKey,ctrl:e.ctrlKey})})}function f(t,{x:e,y:o,shift:l,ctrl:c}){t.setAttribute("dragging",""),t.style.zIndex=1e3,t.setAttribute("shiftX",e-t.getBoundingClientRect().left),t.setAttribute("shiftY",o-t.getBoundingClientRect().top),n.startDrag&&n.startDrag({element:t,x:e,y:o,shift:l,ctrl:c})}function h(t,{x:e,y:o,shift:l,ctrl:c}){t.style.left=e-t.getAttribute("shiftX")+"px",t.style.top=o-t.getAttribute("shiftY")+document.querySelector("html").scrollTop+"px";let y=s.filter(i=>i!==t);n.drag&&n.drag({element:t,x:e,y:o,shift:l,ctrl:c});for(let i of y){let r=i.getBoundingClientRect().left,d=i.getBoundingClientRect().top,p=i.getBoundingClientRect().width,E=i.getBoundingClientRect().height,g=t.getBoundingClientRect().left,u=t.getBoundingClientRect().top,x=t.getBoundingClientRect().width,C=t.getBoundingClientRect().height;g+x>=r&&g<=r+p&&u+C>=d&&u<=d+E?i.hasAttribute("colliding")||(i.setAttribute("colliding",""),n.onCollide&&n.onCollide({collider:t,collided:i})):i.hasAttribute("colliding")&&(i.removeAttribute("colliding"),n.endCollide&&n.endCollide({collider:t,collided:i}))}}function a(t,{x:e,y:o,shift:l,ctrl:c}){t.style.zIndex="unset",t.removeAttribute("dragging"),n.stopDrag&&n.stopDrag({element:t,x:e,y:o,shift:l,ctrl:c})}export{R as add,n as dragger};
