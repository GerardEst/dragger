var s=[];function o(t){s=t.length>0?[...t]:[t],$();for(let e of s)e.ondragstart=()=>!1,A(e),B(e),R(e)}function $(){document.addEventListener("mousemove",t=>{let e=document.querySelector("[dragging]");e&&f(e,{x:t.clientX,y:t.clientY,shift:t.shiftKey,ctrl:t.ctrlKey})})}function x(t){s.push(t),prepareElement(t)}function A(t){t.style.userSelect="none",t.style.position="absolute",t.style.margin=0}function B(t){t.addEventListener("touchstart",e=>{a(e.target,{x:e.touches[0].clientX,y:e.touches[0].clientY})}),t.addEventListener("touchmove",e=>{f(e.target,{x:e.touches[0].clientX,y:e.touches[0].clientY})}),t.addEventListener("touchend",e=>{h(e.target,{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY})})}function R(t){t.addEventListener("mousedown",e=>{a(t,{x:e.clientX,y:e.clientY,shift:e.shiftKey,ctrl:e.ctrlKey})}),t.addEventListener("mouseup",e=>{h(t,{x:e.clientX,y:e.clientY,shift:e.shiftKey,ctrl:e.ctrlKey})})}function a(t,{x:e,y:n,shift:l,ctrl:c}){console.log(`Started: ${e}:${n} - ${l?"shift":"no shift"}, ${c?"ctrl":"no ctrl"}`),t.setAttribute("dragging",""),t.style.zIndex=1e3,t.setAttribute("shiftX",e-t.getBoundingClientRect().left),t.setAttribute("shiftY",n-t.getBoundingClientRect().top),o.startDrag&&o.startDrag({element:t,x:e,y:n,shift:l,ctrl:c})}function f(t,{x:e,y:n,shift:l,ctrl:c}){console.log(`Moving: ${e}:${n} - ${l?"shift":"no shift"}, ${c?"ctrl":"no ctrl"}`),t.style.left=e-t.getAttribute("shiftX")+"px",t.style.top=n-t.getAttribute("shiftY")+document.querySelector("html").scrollTop+"px";let p=s.filter(i=>i!==t);o.drag&&o.drag({element:t,x:e,y:n,shift:l,ctrl:c});for(let i of p){let r=i.getBoundingClientRect().left,d=i.getBoundingClientRect().top,y=i.getBoundingClientRect().width,E=i.getBoundingClientRect().height,g=t.getBoundingClientRect().left,u=t.getBoundingClientRect().top,C=t.getBoundingClientRect().width,b=t.getBoundingClientRect().height;g+C>=r&&g<=r+y&&u+b>=d&&u<=d+E?i.hasAttribute("colliding")||(i.setAttribute("colliding",""),o.onCollide&&o.onCollide({collider:t,collided:i})):i.hasAttribute("colliding")&&(i.removeAttribute("colliding"),o.endCollide&&o.endCollide({collider:t,collided:i}))}}function h(t,{x:e,y:n,shift:l,ctrl:c}){console.log(`Stopped: ${e}:${n} - ${l?"shift":"no shift"}, ${c?"ctrl":"no ctrl"}`),t.style.zIndex="unset",t.removeAttribute("dragging"),o.stopDrag&&o.stopDrag({element:t,x:e,y:n,shift:l,ctrl:c})}export{x as add,o as dragger};
