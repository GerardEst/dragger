var s=[];function n(t){s=t.length>0?[...t]:[t],B();for(let i of s)i.ondragstart=()=>!1,f(i),h(i),a(i)}function B(){document.addEventListener("mousemove",t=>{let i=document.querySelector("[dragging]");i&&p(i,{x:t.clientX,y:t.clientY,shift:t.shiftKey,ctrl:t.ctrlKey})})}function R(t){s.push(t),t.ondragstart=()=>!1,f(t),h(t),a(t)}function f(t){t.style.userSelect="none",t.style.position="absolute",t.style.margin=0}function h(t){t.addEventListener("touchstart",i=>{y(i.target,{x:i.touches[0].clientX,y:i.touches[0].clientY})}),t.addEventListener("touchmove",i=>{p(i.target,{x:i.touches[0].clientX,y:i.touches[0].clientY})}),t.addEventListener("touchend",i=>{x(i.target,{x:i.changedTouches[0].clientX,y:i.changedTouches[0].clientY})})}function a(t){t.addEventListener("mousedown",i=>{y(t,{x:i.clientX,y:i.clientY,shift:i.shiftKey,ctrl:i.ctrlKey})}),t.addEventListener("mouseup",i=>{x(t,{x:i.clientX,y:i.clientY,shift:i.shiftKey,ctrl:i.ctrlKey})})}function y(t,{x:i,y:o,shift:l,ctrl:c}){t.setAttribute("dragging",""),t.style.zIndex=1e3,t.setAttribute("shiftX",i-t.getBoundingClientRect().left),t.setAttribute("shiftY",o-t.getBoundingClientRect().top),n.startDrag&&n.startDrag({element:t,x:i,y:o,shift:l,ctrl:c})}function p(t,{x:i,y:o,shift:l,ctrl:c}){t.style.left=i-t.getAttribute("shiftX")+"px",t.style.top=o-t.getAttribute("shiftY")+document.querySelector("html").scrollTop+"px";let E=s.filter(e=>e!==t);n.drag&&n.drag({element:t,x:i,y:o,shift:l,ctrl:c});for(let e of E){let r=e.getBoundingClientRect().left,d=e.getBoundingClientRect().top,C=e.getBoundingClientRect().width,b=e.getBoundingClientRect().height,g=t.getBoundingClientRect().left,u=t.getBoundingClientRect().top,$=t.getBoundingClientRect().width,A=t.getBoundingClientRect().height;g+$>=r&&g<=r+C&&u+A>=d&&u<=d+b?e.hasAttribute("colliding")||(e.setAttribute("colliding",""),n.onCollide&&n.onCollide({collider:t,collided:e})):e.hasAttribute("colliding")&&(e.removeAttribute("colliding"),n.endCollide&&n.endCollide({collider:t,collided:e}))}}function x(t,{x:i,y:o,shift:l,ctrl:c}){t.style.zIndex="unset",t.removeAttribute("dragging"),n.stopDrag&&n.stopDrag({element:t,x:i,y:o,shift:l,ctrl:c})}export{R as add,n as dragger};
