var s=[];function o(t){s=t.length>0?[...t]:[t],B();for(let i of s)i.ondragstart=()=>!1,f(i),h(i),a(i)}function B(){document.addEventListener("mousemove",t=>{let i=document.querySelector("[dragging]");i&&y(i,{x:t.clientX,y:t.clientY,shift:t.shiftKey,ctrl:t.ctrlKey})})}function f(t){t.style.userSelect="none",t.style.position="absolute",t.style.margin=0}function h(t){t.addEventListener("touchstart",i=>{p(i.target,{x:i.touches[0].clientX,y:i.touches[0].clientY})}),t.addEventListener("touchmove",i=>{y(i.target,{x:i.touches[0].clientX,y:i.touches[0].clientY})}),t.addEventListener("touchend",i=>{x(i.target,{x:i.changedTouches[0].clientX,y:i.changedTouches[0].clientY})})}function a(t){t.addEventListener("mousedown",i=>{p(t,{x:i.clientX,y:i.clientY,shift:i.shiftKey,ctrl:i.ctrlKey})}),t.addEventListener("mouseup",i=>{x(t,{x:i.clientX,y:i.clientY,shift:i.shiftKey,ctrl:i.ctrlKey})})}function y(t,{x:i,y:n,shift:l,ctrl:c}){t.style.left=i-t.getAttribute("shiftX")+"px",t.style.top=n-t.getAttribute("shiftY")+document.querySelector("html").scrollTop+"px";let E=s.filter(e=>e!==t);o.drag&&o.drag({element:t,x:i,y:n,shift:l,ctrl:c});for(let e of E){let r=e.getBoundingClientRect().left,d=e.getBoundingClientRect().top,C=e.getBoundingClientRect().width,b=e.getBoundingClientRect().height,g=t.getBoundingClientRect().left,u=t.getBoundingClientRect().top,$=t.getBoundingClientRect().width,A=t.getBoundingClientRect().height;g+$>=r&&g<=r+C&&u+A>=d&&u<=d+b?e.hasAttribute("colliding")||(e.setAttribute("colliding",""),o.onCollide&&o.onCollide({collider:t,collided:e})):e.hasAttribute("colliding")&&(e.removeAttribute("colliding"),o.endCollide&&o.endCollide({collider:t,collided:e}))}}function R(t){s.push(t),t.ondragstart=()=>!1,f(t),h(t),a(t)}function p(t,{x:i,y:n,shift:l,ctrl:c}){t.setAttribute("dragging",""),t.style.zIndex=1e3,t.setAttribute("shiftX",i-t.getBoundingClientRect().left),t.setAttribute("shiftY",n-t.getBoundingClientRect().top),o.startDrag&&o.startDrag({element:t,x:i,y:n,shift:l,ctrl:c})}function x(t,{x:i,y:n,shift:l,ctrl:c}){t.style.zIndex="unset",t.removeAttribute("dragging"),o.stopDrag&&o.stopDrag({element:t,x:i,y:n,shift:l,ctrl:c})}export{R as add,o as dragger,p as startDrag,x as stopDrag};
